<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.lebaoxun.modules.account.dao.UserLogDao">

	<!-- 可根据自己的需求，是否要使用 -->
	<resultMap type="com.lebaoxun.modules.account.entity.UserLogEntity"
		id="userLogMap">
		<result property="id" column="id" />
		<result property="userId" column="user_id" />
		<result property="account" column="account" />
		<result property="createTime" column="create_time" />
		<result property="logType" column="log_type" />
		<result property="platform" column="platform" />
		<result property="tradeMoney" column="trade_money" />
		<result property="money" column="money" />
		<result property="descr" column="descr" />
		<result property="adjunctInfo" column="adjunct_info" />
		<result property="score" column="score" />
		<result property="tradeScore" column="trade_score" />
		<result property="token" column="token" />
		<result property="logTime" column="log_time" />
	</resultMap>

	<select id="queryAllLogType" resultType="java.util.Map">
		select log_type,descr from user_log group by log_type;
	</select>

	<select id="queryAccountLogByUserId" resultMap="userLogMap">
		select id,user_id,account,create_time,log_type,platform,trade_money,money,descr,adjunct_info,score,trade_score,token,log_time from
		user_log
		where user_id=#{user_id,jdbcType=BIGINT}
		<if test="flag != null">
			and trade_money <![CDATA[!=]]> 0
		</if>
		<if test="logType != null">
			and log_type = #{logType}
		</if>
		ORDER BY create_time DESC
		<if test="size != null">
			limit
			<if test="offset != null">
				#{offset,jdbcType=INTEGER},
			</if>
			#{size,jdbcType=INTEGER}
		</if>
	</select>

	<!-- <select id="">
		select sum(trade_money),user_id from user_log where
		DATE_FORMAT(create_time,"%Y%m") = #{time} and log_type = #{lotType}
		group by user_id;
	</select> -->
	
	<select id="sumTradeMoneyByUser" resultType="java.lang.Long">
	    select sum(trade_money) from user_log where 
	    user_id = #{userId}
	    <if test="time != null">
		    and DATE_FORMAT(create_time,"%Y%m") = #{time} 
	    </if>
	    <if test="logType != null">
	    	and log_type = #{logType} 
	    </if>
	</select>
	
	<select id="queryUserLogByDay" resultType="userLogMap">
	    SELECT id,user_id,account,create_time,log_type,platform,trade_money,money,descr,adjunct_info,score,trade_score,token,log_time 
		FROM user_log 
		WHERE user_id = #{userId}
	    <if test="adjunctInfo != null">
	    	AND adjunct_info = #{adjunctInfo} 
	    </if>
	    <if test="dayTime != null">
		    AND DATE_FORMAT(log_time,"%Y%m%d") = #{dayTime} 
	    </if>
	</select>
</mapper>