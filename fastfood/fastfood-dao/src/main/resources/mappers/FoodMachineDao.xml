<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.lebaoxun.modules.fastfood.dao.FoodMachineDao">

	<resultMap
		type="com.lebaoxun.modules.fastfood.entity.FoodMachineProductCatEntity"
		id="foodMachineProductCatMap">
		<result property="id" column="cat_id" />
		<result property="name" column="cat_name" />
		<result property="icon" column="icon" />
	</resultMap>

	<!-- 可根据自己的需求，是否要使用 -->
	<resultMap type="com.lebaoxun.modules.fastfood.entity.FoodMachineEntity"
		id="foodMachineMap">
		<result property="id" column="id" />
		<result property="imei" column="IMEI" />
		<result property="host" column="host" />
		<result property="areaCode" column="area_code" />
		<result property="address" column="address" />
		<result property="pos" column="pos" />
		<result property="notice" column="notice" />
		<result property="catId" column="cat_id" />
		<result property="partnerId" column="partner_id" />
		<result property="status" column="status" />
		<result property="replenishMan" column="replenish_man" />
		<result property="pickingMan" column="picking_man" />
		<result property="maintenanceMan" column="maintenance_man" />
		<result property="remark" column="remark" />
		<result property="createTime" column="create_time" />
		<result property="createBy" column="create_by" />
		<result property="updateBy" column="update_by" />
		<result property="updateTime" column="update_time" />
		<collection property="activitys" ofType="java.lang.String">
			<result property="activityType" column="activity_type" />
		</collection>

		<collection property="productCats" resultMap="foodMachineProductCatMap"
			ofType="com.lebaoxun.modules.fastfood.entity.FoodMachineProductCatEntity">
		</collection>
	</resultMap>

	<insert id="save"
		parameterType="com.lebaoxun.modules.fastfood.entity.FoodMachineEntity"
		useGeneratedKeys="true" keyProperty="id">
		INSERT INTO food_machine (
		id,
		imei, host,
		area_code, pos, notice,
		cat_id, partner_id, status,
		manager_id,
		replenish_man, picking_man, maintenance_man,remark,
		create_time,create_by,
		update_time, update_by)
		VALUES
		(
		#{id}, #{imei},
		#{host},
		#{areaCode}, #{pos}, #{notice},
		#{catId}, #{partnerId},
		#{status},
		#{managerId},
		#{replenishMan},#{pickingMan},#{maintenanceMan},#{remark},
		#{createTime}, #{createBy},
		#{updateTime}, #{updateBy});
	</insert>

	<select id="findByAreaCode" resultMap="foodMachineMap">
		select
		mac.area_code,mac.IMEI,mac.pos,
		mac.`status`,mac.id,
		mac.address,
		mac_activity.activity_type
		from food_machine as mac
		left join food_machine_activity_ref as
		mac_activity on
		mac_activity.mac_id
		= mac.id
		where mac.area_code =
		#{areaCode}
	</select>

	<select id="findByMacId" resultMap="foodMachineMap">
		SELECT
		mac.area_code,
		mac.IMEI,
		mac.pos,
		mac.`status`,
		mac.id,
		mac.address,
		mac_activity.activity_type,
		product_cat.icon,
		product_cat.id as cat_id,
		product_cat.`name` as cat_name
		FROM
		food_machine AS mac
		LEFT JOIN food_machine_activity_ref AS mac_activity ON
		mac_activity.mac_id = mac.id
		LEFT JOIN food_machine_product_cat as
		product_cat on product_cat.mac_id = mac.id
		WHERE
		mac.id = #{macId}
	</select>

	<select id="findByMacOpenApiById" resultType="java.util.Map">
		SELECT
			mac.id AS macId,
			mac.IMEI AS macCode,
			mac. HOST,
			mac.notice,
			mac.cat_id AS catId,
			cat.`name` AS cat_name,
			mac.address
		FROM
			food_machine AS mac
		LEFT JOIN food_machine_product_cat AS cat ON mac.id = cat.mac_id
		WHERE
		mac.id = #{macId}
	</select>

	<select id="findByMacRefProductById" resultType="java.util.Map">
		SELECT
			product.id AS productId,
			product. NAME AS productName,
			product.show_price AS showPrice,
			product.give_score AS giveScore,
			product.period AS period,
			product.remind AS remind,
			product.picture AS picture,
			product.total_stock AS totalStock,
			product.unit AS unit,
			product.zs_weight AS zsWeight,
			product.cp_weight AS cpWeight,
			product.warm_flag AS isWarm,
			product.warm_time AS warmTime,
			product.hot_num AS hotNum,
			product.label AS label,
			product. STATUS,
			product.up_time AS upTime,
			product.down_time AS downTime,
			product.descr,
			mac.cat_id AS catId,
			cat. NAME AS catName
		FROM
			food_machine AS mac
		LEFT JOIN food_machine_aisle AS ais ON mac.id = ais.mac_id
		LEFT JOIN food_product AS product ON product.id = ais.product_id
		LEFT JOIN food_machine_product_cat AS cat ON mac.id = cat.mac_id
		WHERE
		mac.id = #{macId}
	</select>
</mapper>